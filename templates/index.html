<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processing App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                },
            },
        }
    </script>
    <style type="text/css">
        :root {
            --background: 240 10% 3.9%;
            --foreground: 0 0% 98%;
            --card: 240 10% 3.9%;
            --card-foreground: 0 0% 98%;
            --popover: 240 10% 3.9%;
            --popover-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 240 5.9% 10%;
            --secondary: 240 3.7% 15.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 240 3.7% 15.9%;
            --muted-foreground: 240 5% 64.9%;
            --accent: 240 3.7% 15.9%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 3.7% 15.9%;
            --input: 240 3.7% 15.9%;
            --ring: 240 4.9% 83.9%;
        }
    </style>
</head>
<body class="bg-background text-foreground min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold mb-8 text-center text-emerald-500">Insurance Portal App</h1>
        
        <div class="mb-6">
            <div class="flex space-x-2 justify-center">
                <button onclick="openTab(event, 'Section1')" class="tablinks px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2" id="defaultOpen">Car Damage Analysis</button>
                <button onclick="openTab(event, 'Section2')" class="tablinks px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">Car Registration</button>
                <button onclick="openTab(event, 'Section3')" class="tablinks px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">Document Verification</button>
            </div>
        </div>

        <div id="Section1" class="tabcontent">
            <div class="bg-card p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-medium text-emerald-500">Automated car damage analysis for fast, accurate insurance assessments and claim processing.</h2>
                <div class="mb-4">
                    <label for="imageUpload1" class="block text-sm font-medium mb-2">Upload Image</label>
                    <input type="file" id="imageUpload1" accept="image/*" class="block w-full text-sm text-foreground
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-secondary file:text-secondary-foreground
                        hover:file:bg-secondary/80">
                </div>
                <button onclick="processImage(1)" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">Process Image</button>
                
                <div class="mt-6">
                    <h3 class="text-xl font-semibold mb-2">Result</h3>
                    <div id="result-container1" class="min-h-[200px] flex items-center justify-center bg-muted rounded-md">
                        <img id="result-image1" src="" alt="Processed Image" class="max-w-full h-auto rounded-md hidden">
                        <p id="placeholder-text1" class="text-muted-foreground">No image processed yet</p>
                    </div>
                    <pre id="metadata1" class="mt-4 p-4 bg-muted rounded-md overflow-x-auto"></pre>
                </div>
            </div>
        </div>

        <div id="Section2" class="tabcontent hidden">
            <div class="bg-card p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-medium text-emerald-500">Comprehensive car parts analysis at registration to ensure accurate insurance coverage and assessment.</h2>
                <div class="mb-4">
                    <label for="imageUpload2" class="block text-sm font-medium mb-2">Upload Image</label>
                    <input type="file" id="imageUpload2" accept="image/*" class="block w-full text-sm text-foreground
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-secondary file:text-secondary-foreground
                        hover:file:bg-secondary/80">
                </div>
                <button onclick="processImage(2)" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">Process Image</button>

                <div class="mt-6">
                    <h3 class="text-xl font-semibold mb-2">Result</h3>
                    <div id="result-container2" class="min-h-[200px] flex items-center justify-center bg-muted rounded-md">
                        <img id="result-image2" src="" alt="Processed Image" class="max-w-full h-auto rounded-md hidden">
                        <p id="placeholder-text2" class="text-muted-foreground">No image processed yet</p>
                    </div>
                    <pre id="metadata2" class="mt-4 p-4 bg-muted rounded-md overflow-x-auto"></pre>
                </div>
            </div>
        </div>

        <div id="Section3" class="tabcontent hidden">
            <div class="bg-card p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-medium text-emerald-500">AI-powered document verification for fast, accurate, and secure insurance processing.</h2>
                <div class="mb-4">
                    <label for="imageUpload3" class="block text-sm font-medium mb-2">Upload Image</label>
                    <input type="file" id="imageUpload3" accept="image/*" class="block w-full text-sm text-foreground
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-secondary file:text-secondary-foreground
                        hover:file:bg-secondary/80">
                </div>
                <button onclick="processImage(3)" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">Process Image</button>
                
                <div class="mt-6">
                    <h3 class="text-xl font-medium mb-2">Result</h3>
                    <div id="result-container3" class="min-h-[200px] flex items-center justify-center bg-muted rounded-md">
                        <img id="result-image3" src="" alt="Processed Image" class="max-w-full h-auto rounded-md hidden">
                        <p id="placeholder-text3" class="text-muted-foreground">No image processed yet</p>
                    </div>
                    <pre id="metadata3" class="mt-4 p-4 bg-muted rounded-md overflow-x-auto"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.add("hidden");
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("bg-primary", "text-primary-foreground");
                tablinks[i].classList.add("bg-secondary", "text-secondary-foreground");
            }
            document.getElementById(tabName).classList.remove("hidden");
            evt.currentTarget.classList.remove("bg-secondary", "text-secondary-foreground");
            evt.currentTarget.classList.add("bg-primary", "text-primary-foreground");
        }

        document.getElementById("defaultOpen").click();

        function selectSampleImage(img, sectionNumber) {
            const resultImage = document.getElementById(`result-image${sectionNumber}`);
            const placeholderText = document.getElementById(`placeholder-text${sectionNumber}`);
            resultImage.src = img.src;
            resultImage.classList.remove('hidden');
            placeholderText.classList.add('hidden');
        }

        function processImage(sectionNumber) {
            const fileInput = document.getElementById(`imageUpload${sectionNumber}`);
            const resultImage = document.getElementById(`result-image${sectionNumber}`);
            const placeholderText = document.getElementById(`placeholder-text${sectionNumber}`);
            const metadataElement = document.getElementById(`metadata${sectionNumber}`);

            if (!fileInput.files[0] && !resultImage.src) {
                alert('Please select an image first');
                return;
            }

            const formData = new FormData();
            if (fileInput.files[0]) {
                formData.append('image', fileInput.files[0]);
                console.log("image uploaded, send request here")
            } else {
                // If using a sample image, fetch it and append to formData
                
                console.log("image sample, send request here")
                fetch(resultImage.src)
                    .then(res => res.blob())
                    .then(blob => {
                        formData.append('image', blob, 'sample.jpg');
                        sendRequest();
                    });
                return;
            }

            sendRequest();

            function sendRequest() {
                // Show loading state
                placeholderText.textContent = 'Processing...';
                resultImage.classList.add('hidden');
                placeholderText.classList.remove('hidden');

                console.log("Section Number:", sectionNumber);
                // Determine the API endpoint based on sectionNumber
                let apiEndpoint;
                if (sectionNumber === 1) {
                    apiEndpoint = '/process_image';
                } else if (sectionNumber === 2) {
                    apiEndpoint = '/car_analysis';
                } else if (sectionNumber === 3) {
                    apiEndpoint = '/document_analysis';
                } else {
                    apiEndpoint = '/default_process';  // Fallback endpoint if sectionNumber is unknown
                }

                fetch(apiEndpoint, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    resultImage.src = data.processed_image;
                    resultImage.classList.remove('hidden');
                    placeholderText.classList.add('hidden');
                    metadataElement.textContent = JSON.stringify(data.metadata, null, 2);
                })
                .catch(error => {
                    console.error('Error:', error);
                    placeholderText.textContent = 'Error processing image';
                    resultImage.classList.add('hidden');
                    placeholderText.classList.remove('hidden');
                });
            }
}
    </script>
</body>
</html>